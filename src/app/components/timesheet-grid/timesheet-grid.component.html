<!-- Updated timesheet-grid.component.html -->
<p-table [value]="projects" dataKey="id" [tableStyle]="{ 'min-width': '100%' }"
         [expandedRowKeys]="expandedRows"
         (onRowExpand)="onRowExpand($event)"
         (onRowCollapse)="onRowCollapse($event)">  <!-- Toolbar for expand/collapse -->
  <ng-template pTemplate="caption">
    <div class="flex justify-end gap-2 p-2">
      <p-button label="Expand All" icon="pi pi-plus" text (onClick)="expandAll()" />
      <p-button label="Collapse All" icon="pi pi-minus" text (onClick)="collapseAll()" />
    </div>
  </ng-template><!-- Header like InTime Pro -->
  <ng-template pTemplate="header">
    <tr>
      <th style="width: 3rem"></th>
      <th style="width: 200px">Projects / Tasks</th>
      <th style="width: 180px">Description</th>
      <th style="width: 120px">Billability</th>
    <th *ngFor="let d of daysOfWeek" style="width: 100px">
  {{ d.day }}<br /><small>{{ d.date }}</small>
</th>

    </tr>
  </ng-template>

  <!-- Project Row -->  
  <ng-template #body let-project let-expanded="expanded">
    <tr>
      <td>
        <p-button type="button" [pRowToggler]="project"
                  [icon]="expanded ? 'pi pi-chevron-down' : 'pi pi-chevron-right'" text></p-button>
      </td>
      <td>
  <div class="whitespace-nowrap overflow-hidden text-ellipsis font-semibold text-sm">
    {{ project.name }}  
  </div>
</td>

      <td></td>      <td>
        <p-inputSwitch [(ngModel)]="project.billable" name="projectBillable_{{project.id}}" (onChange)="updateProjectBillable(project)" [style]="{ 'transform': 'scale(0.8)' }"></p-inputSwitch>
      </td>
         <!-- In your timesheet-grid.component.html, check how the totals are displayed -->
      <td *ngFor="let d of daysOfWeek" class="text-center font-bold">
        {{ calculateProjectTotal(project, d.day) }}
      </td>

    </tr>
    <tr>
      <td></td>
      <td colspan="10">
 <a href="#" (click)="openTaskForm(project); $event.preventDefault()">+ Task</a>
 

      </td>     
    </tr>
  </ng-template>
                       
  <!-- Task Row (Expandable) -->
<ng-template #expandedrow let-project>  
  <tr *ngFor="let task of project.tasks" class="align-middle border-t border-gray-200 text-sm">
    <td></td>
    <!-- Task Name with Pencil -->
    <td class="whitespace-nowrap">
      <div class="flex items-center gap-2"> 
        <i class="pi pi-pencil text-gray-500 text-sm cursor-pointer"></i>
        <span class="truncate">{{ task.name }}</span>
      </div>
    </td>    <!-- Description --> 
    <td>   
      <input type="text"
      
             [(ngModel)]="task.description" 
             placeholder="Description"
             class="input-cell" style="text-align: left;" />
    </td>    <!-- Billability -->
    <td>
      <p-inputSwitch [(ngModel)]="task.billable" name="taskBillable_{{task.id}}" (onChange)="updateTaskBillable(task)" [style]="{ 'transform': 'scale(0.8)' }"></p-inputSwitch>
    </td>    <!-- Hours for Each Day -->    <td *ngFor="let d of daysOfWeek" class="time-cell">      <input type="text"
             [(ngModel)]="task.hours[d.day]"
             name="taskHours_{{task.id}}_{{d.day}}"
             placeholder="00:00"
             appTimeInput
             (blur)="updateTaskHours(project, task, d.day, task.hours[d.day])"
             class="time-input" />
    </td>
  </tr>
</ng-template>

</p-table>

<app-task-form
  [visible]="showTaskForm"
  [availableProjects]="projects"
  [currentProject]="selectedProject"
  (close)="showTaskForm = false"
  (save)="handleTaskSave($event)">
</app-task-form>

<!-- 
<app-task-form></app-task-form> -->
